class e extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let n;try{n=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?n:{...n,...JSON.parse(e.nodeValue)}}catch(e){console.log(this.nodeName,"ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,n)=>{const s=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),r=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var i=Array.prototype.slice.call(n.childNodes),a=Array.prototype.slice.call(e.childNodes),l=i.length-a.length;if(l>0)for(;l>0;l--)i[i.length-l].parentNode.removeChild(i[i.length-l]);a.forEach((function(e,a){if(i[a])if(s(e)===s(i[a])){var l=r(e);if(l&&l!==r(i[a])&&(i[a].textContent=l),i[a].childNodes.length>0&&e.childNodes.length<1)i[a].innerHTML="";else{if(i[a].childNodes.length<1&&e.childNodes.length>0){var o=document.createDocumentFragment();return t(e,o),void i[a].appendChild(o)}e.childNodes.length>0&&t(e,i[a])}}else i[a].parentNode.replaceChild(e.cloneNode(!0),i[a]);else n.appendChild(e.cloneNode(!0))}))},n=(s=this.template,(new DOMParser).parseFromString(s,"text/html").body);var s;t(n,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",e);const t=1024,n="vertuo",s="/machineTechno/";function r(e){const t=e.technologies[0];return t.substring(t.indexOf(s)+s.length)}function i(e,t){return e%t==0}function a(e,t=r){return 1!==e.sales_multiple&&i(e.sales_multiple,10)?e.sales_multiple/10:1!==e.sales_multiple&&t(e)===n&&i(e.sales_multiple,7)?e.sales_multiple/7:1===e.sales_multiple&&i(e.unitQuantity,10)?e.unitQuantity/10:1===e.sales_multiple&&t(e)===n&&i(e.unitQuantity,7)?e.unitQuantity/7:NaN}const l=async e=>{const t=await(async()=>await window.napi.priceFormat())(),n=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(n,e):t.short(n,e)||""},o=e=>e.querySelector(".cb-price-old"),c=({strikethrough_price:e},t)=>{return e?((n=e,l(n)).then((e=>{const n=o(t);n&&(n.innerHTML=e)})).catch((e=>{console.error(`Error: Component SKU - Strike Through Price  - ${e}`);const n=o(t);n&&(n.style.display="none")})),'<p class="cb-price-old"></p>'):"";var n};function p(e,t,n,s){let r=0;for(;e;){const i=e.indexOf(n,r);if(-1===i)break;const a=e.indexOf(s,i+1);if(-1===a)break;const l=e.substring(i+n.length,a);null!=t[l]?(e=e.substr(0,i)+t[l]+e.substr(a+s.length),r=i):r=a}return e}const u=e=>d(JSON.stringify(e)),d=e=>{const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>t[e]))},h=e=>{const{show_sleeve:t=!1}=e;if(!t)return"";const{label_capsules:n,sleeve_syntax:s}=e,r=(e=>{const{number_of_sleeves:t,label_sleeves:n,label_sleeve:s}=e;return(t||a(e))>1&&n?n:s})(e),i=e.number_of_capsules?e.number_of_capsules:(({bundled:e,sales_multiple:t,unit_quantity:n,unitQuantity:s})=>!1===e?t:n||s||0)(e),l=p(s,{numberOfSleeves:e.number_of_sleeves?e.number_of_sleeves:a(e),sleeveLabel:r,quantity:i,label_capsules:n,sleevePrice:e.hasPricePerSleeve?e.sleevePrice:"",perSleeveLabel:e.hasPricePerSleeve?e.perSleeveLabel:""},"{","}");return l?`<p class="cb-price-items cb-show-sleeve">${l}</p>`:""},m={get is(){const{innerWidth:e,devicePixelRatio:n}=window;return{mobile:e<768,mobile_tablet:e<t,tablet:e>=768&&e<t,desktop:e>=t&&n<=1,retina:e>=t&&n>1}},lt:e=>window.innerWidth<e},g="plp";window.napi&&window.napi.ratings;const b=4,_={carafe:{ml:535,oz:18.09},"carafe-vertuo":{ml:535,oz:18.09},alto:{ml:335,oz:11.33},mug:{ml:230,oz:7.77},gran_lungo:{ml:150,oz:5.07},lungo:{ml:110,oz:3.7},double_espresso:{ml:80,oz:2.7},"double-espresso-vertuo":{ml:80,oz:2.7},espresso:{ml:40,oz:1.35},"espresso-vertuo":{ml:40,oz:1.35},ristretto:{ml:25,oz:.84}};class v extends e{loadTemplate(){const{popin_id:e,close:t,footer:n}=this.props.popin,{product:s}=this.props;if(this.product=s,!e||!this.product.name)return"";this.template=`<nb-popin\n                id="${e}"\n                heading="${this.product.name}"\n                size="S"\n                variation="next"\n                bgcolor="highlight"\n                label_close="${t}"\n                footer="${n}"\n            >\n                ${this.renderProduct()}\n                ${this.renderLevels()}\n                ${this.renderCupSizes()}\n                ${this.renderAromaticProfile()}\n                ${this.renderFeatures()}\n                ${this.renderIngredients()}\n                ${this.renderLink()}\n            </nb-popin>`,this.render(),this.renderFooter()}renderProduct(){let e="";return this.product.headline&&""!==this.product.headline?e=this.product.headline:this.product.description&&(e=this.product.description),`\n            <div class='cb-row'>\n                ${this.renderImageOrSlider()}\n                <div>\n                    <div class="t-xs-500 wysiwyg">${e}</div>\n                    ${this.renderProductType()}\n                </div>\n            </div>\n        `}renderProductType(){switch(this.product.type){case"capsule":return this.renderCoffee();case"machine":return this.renderMachine();default:return""}}renderCoffee(){const{product:e,intensity:t}=this.props;return t?`\n            ${(({technologies:e,intensity:t,a11y_intensity_max:n,intensity_label:s=""})=>{const r=(({technologies:e})=>-1!==e.indexOf("original")?14:12)({technologies:e});return 0===t?"":`<nb-intensity\n        class="t-xs-500-sl"\n        intensity="${t}"\n        max_intensity="${r}"\n        a11y_intensity_max="${n}"\n        intensity_label="${s}">\n    </nb-intensity>`})({...t,intensity:e.capsuleProperties?.intensity,technologies:e.technologies})}\n            ${this.renderRoast()}\n        `:""}renderMachine(){const{showVoltage:e,colors:t}=this.props;return`\n            ${this.renderRatings()}\n            ${(e=>{if(!e)return"";const{show_voltage:t,voltage_label:n,voltage_list:s,a11y_voltage_label:r,a11y_volts_label:i}=e;return t&&n&&s&&s.length?`<div class="cb-sku-tab">\n        <span class="sr-only">${r}</span>\n        <p class='t-sm-400' aria-hidden="true">${n}</p>\n        ${s.map((({label:e,url:t})=>t?`<a href="${t}" target="_self"><span class="t-sm-400-caps">${e}<span aria-hidden="true">V</span><span class='sr-only'> ${i}</span></span></a>`:`<div aria-current="page"><span class="t-sm-700-caps">${e}<span aria-hidden="true">V</span><span class='sr-only'> ${i}</span></span></div>`)).join("")}\n    </div>`:""})(e)}\n            ${(e=>{if(!e)return"";const{colors:t,sku:n,max_colors:s=b,a11y_extra_color:r="",url:i,activeSku:a,name:l}=e;return t?`<nb-colors data="${u({colors:t,max_colors:s,activeSku:a||n,extra_url:i,extra_title:l+", "+r})}" size="${m.is.mobile?"small":"large"}"></nb-colors>`:""})(t)}\n        `}renderRatings(){const{showRating:e}=this.props;return(t=this.product).productRatings&&t.productRatings.ratingEnabled&&e&&e.ratings&&e.ratings.ratingAverage?`${(e=>{const{show_ratings:t,minimum_rating:n=0,ratingAverage:s,reviewCount:r,review_cta:i,reviews_cta:a}=e;if(!t||!((e,t)=>e.reviewCount>0&&e.ratingAverage>0&&e.ratingAverage>=t)(e,n))return"";let l="";if(r&&i&&a){const e=(r>1?a:i).replace("{nb_review}",r);e&&(l=`<nb-link class="is-review" icon_right="chevron-right" size="small" color="gold">\n                        ${e}\n                    </nb-link>`)}return`<nb-rating stars="${parseFloat(s).toFixed(2)}"></nb-rating>\n            ${l}`})({...e,ratingAverage:e.ratings.ratingAverage,reviewCount:1})}`:"";var t}renderImageOrSlider(){return this.product.images.icon?`<img src='${this.product.images.icon}' alt='' aria-hidden='true' loading='lazy' />`:""}renderRoast(){const{product:e,levels:t}=this.props;return t&&t.roast&&e.roast.label?`<p class="t-xs-500 cb-roast">${t.roast} <strong>${e.roast.label}</strong></p>`:""}renderLevels(){const{levels:e}=this.props;return"capsule"===this.product.type&&e?`<div class="cb-properties cb-levels">\n            <ul>\n               ${this.renderLevelItem(e.roastiness_label,this.product.roast.value)}\n               ${this.renderLevelItem(e.bitterness_label,this.product.bitterness.value)}\n               ${this.renderLevelItem(e.body_label,this.product.body.value)}\n               ${this.renderLevelItem(e.acidity_label,this.product.acidity.value)}\n            </ul>\n        </div>`:""}renderLevelItem(e,t){const{a11y_level_of:n}=this.props.levels;return e&&t?`<li>\n            <h3 class="t-xs-700">${e}</h3>\n            <nb-level value="${t}" a11y_level_of="${n}"></nb-level>\n        </li>`:""}renderCupSizes(){const{cup_sizes:e}=this.props;return"capsule"===this.product.type&&e&&e.heading&&e.items?`<div class="cb-properties cb-cup-sizes">\n            <h3 class="t-xs-700">${e.heading}</h3>\n            <ul>\n                ${e.items.map((e=>`${this.renderCupSizeItem(e)}`)).join("")}\n            </ul>\n        </div>`:""}renderCupSizeItem(e){let t,n,s;if("string"==typeof e?(t=e,n=t.toLowerCase(),s=`capsule-cupSize-${n}`):(t=e.label,n=e.capacityLabel,s=e.icon),!t)return"";const{unit_is_oz:r}=this.props.cup_sizes;return`<li>\n            <nb-icon-text\n                icon="${s}"\n                label="${t}"\n                sub_label="${((e,t)=>{const n=t?"oz":"ml",s=_[e];return s?`${s[n]} ${n}`:""})(n,r)}"\n                classname="t-xs-500">\n            </nb-icon-text>\n        </li>`}renderAromaticProfile(){const{aromatic_profile:e}=this.props;if("capsule"!==this.product.type||!e?.heading||!e?.items||0===e.items.length)return"";let t="";return e.items.map((e=>{t+=`${e.toLowerCase()}, `})),t=t.slice(0,-2),`<div class='cb-properties cb-aromatic'>\n            <h3 class="t-xs-700">${e.heading}</h3>\n            <p class="t-xs-500">${t}</p>\n        </div>`}renderFeatures(){const{features:e}=this.props;return"machine"!==this.product.type||!e&&!this.product.features?"":e&&0!==e.length?`<ul class='cb-features'>${e.map((e=>`${this.renderFeatureItem(e)}`)).join("")}</ul>`:this.product.features&&0!==this.product.features?`<ul class='cb-features'>${this.product.features.map((e=>`${this.renderFeatureItemApi(e)}`)).join("")}</ul>`:""}renderFeatureItem(e){const{icon:t,heading:n,description:s}=e;return t&&n&&s?`<li class="cb-properties">\n            <nb-icon-text\n                icon="${t}"\n                label="${n}"\n                sub_label="${s}"\n                classname="t-xs-500">\n            </nb-icon-text>\n        </li>`:""}renderFeatureItemApi(e){const{name:t,description:n,unitOfMeasure:s}=e;if(!t)return"";let r="";return n&&(r+=n),s&&(r+=s),`<div class="cb-properties">\n            <nb-icon-text\n                icon=""\n                label="${t}"\n                sub_label="${r}"\n                classname="t-xs-500">\n            </nb-icon-text>\n        </div>`}renderIngredients(){const{ingredients:e}=this.props;return"accessory"===this.product.type&&e&&e.heading&&e.description?`<div class="cb-properties cb-ingredients">\n            <nb-icon-text\n                icon="notes-cereal"\n                label="${e.heading}"\n                sub_label="${e.description}"\n                classname="t-xs-500">\n            </nb-icon-text>\n        </div>`:""}renderLink(){const{tracking_list:e,tracking_position:t}=this.props,{label:n,url:s}=this.props.link;if(!n||!s)return"";const r={id:this.props.product.id};return`<div class="cb-properties cb-link">\n                    <nb-link\n                        link="${s}"\n                        target="_self"\n                        size="xsmall"\n                        campaign_id="${d(this.props.campaign?.id||"")}"\n                        campaign_name="${d(this.props.campaign?.name||"")}"\n                        campaign_position="${d(this.props.campaign?.position||"")}"\n                        campaign_creative="${d(this.props.campaign?.creative||"")}"\n                        data="${u({product:r})}"\n                        long_sku="${r.id}"\n                        tracking_position="${t}"\n                        tracking_list="${e}"\n                    >${n}</nb-link>\n                </div>`}renderPricing(){return`<div class='cb-price'>\n            ${c(this.props.pricing,this)}\n            ${(({price:e,hidePrice:t,giftcard_price:n,price_per_capsule:s,show_sleeve_price:r,type:i})=>{if(!e&&!n||t)return"";let a=null;return a=!r&&s?s:e,"capsule"!==i&&(a=e),`<p class="cb-price-current"><span>${a||n}</span></p>`})(this.props.pricing.add_to_cart)}\n            ${this.renderCapsuleExtraPricing()}\n        </div>`}renderCapsuleExtraPricing(){return"capsule"!==this.product.type?"":`\n            ${h(this.props.pricing.showSleeve)}\n            ${(e=>{const{show_capsule_price:t=!1,capsule_price_label:n,capsule_price_syntax:s="{capsule_price_label}: {price_per_capsule}",price_per_capsule:r,show_sleeve_price:i}=e;if(!t||!n||!i)return"";const a=p(s,{capsule_price_label:n,price_per_capsule:r},"{","}");return a&&r?`<p class="cb-price-items cb-price-capsule">${a}</p>`:""})(this.props.pricing.showCapsulePrice)}\n        `}renderAction(){return`<div class='cb-action'>\n            ${(e=>{const{category_name:t="",activeSku:n,sku:s,activeLongSku:r,longSku:i="",position:a,variation:l=g,hidePrice:o,url:c,view_details_label:p="View details",show_view_details:u=!1,rendererName:d="",is_machine_b2b:h=!1,contact_cta:b={}}=e;let _="large";l===g&&(_=m.is.mobile?"small":"large"),"small"===l&&(_="small");let v=c,$=p,f=b.show_contact_cta||!1,y=b.contact_cta_text||"",w=b.contact_url_anchor||"";return o||u?h&&f?(v=w,$=y,`<nb-cta\n            ${w?`link="${v}"`:""}\n            variation="primary">${$}</nb-cta>`):`<nb-cta link="${v}" variation="primary">${$}</nb-cta>`:`\n        <nb-add-to-cart\n            sku="${n||s}"\n            longSku="${r||i}"\n            buttonSize="${_}"\n            showPrice\n            range='${t}'\n            position='${a}'\n            rendererName='${d}'\n        ></nb-add-to-cart>\n    `})(this.props.pricing.add_to_cart)}\n        </div>`}renderFooter(){const{popin:e,pricing:t}=this.props;var n;!(!(n=e.footer)||"false"===n)&&t&&(this.footer=this.querySelector("footer"),this.footer&&(this.footer.innerHTML=`\n                ${this.renderPricing()}\n                ${this.renderAction()}\n            `))}}customElements.get("nb-sku-quick-view")||customElements.define("nb-sku-quick-view",v);export{v as default};
