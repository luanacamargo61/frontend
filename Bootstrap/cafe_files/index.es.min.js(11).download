const e=1024;class t extends HTMLElement{constructor(){super(),this.template=""}connectedCallback(){this.props=this._createProps(),this.onStart?.(),this.loadTemplate(),this.onReady?.()}_createProps(e=null){const t=e||this.attributes;let i;try{i=[...t].reduce(((e,t)=>({...e,[t.nodeName]:t.nodeValue})),{});const e=[...t].find((e=>"data"===e.nodeName));return null==e?i:{...i,...JSON.parse(e.nodeValue)}}catch(e){console.log(this.nodeName,"ERROR: No data",e)}}render(e=!1){e&&(this.innerHTML="");const t=(e,i)=>{const n=e=>3===e.nodeType?"text":8===e.nodeType?"comment":e.tagName.toLowerCase(),r=e=>e.childNodes&&e.childNodes.length>0?null:e.textContent;var s=Array.prototype.slice.call(i.childNodes),a=Array.prototype.slice.call(e.childNodes),o=s.length-a.length;if(o>0)for(;o>0;o--)s[s.length-o].parentNode.removeChild(s[s.length-o]);a.forEach((function(e,a){if(s[a])if(n(e)===n(s[a])){var o=r(e);if(o&&o!==r(s[a])&&(s[a].textContent=o),s[a].childNodes.length>0&&e.childNodes.length<1)s[a].innerHTML="";else{if(s[a].childNodes.length<1&&e.childNodes.length>0){var c=document.createDocumentFragment();return t(e,c),void s[a].appendChild(c)}e.childNodes.length>0&&t(e,s[a])}}else s[a].parentNode.replaceChild(e.cloneNode(!0),s[a]);else i.appendChild(e.cloneNode(!0))}))},i=(n=this.template,(new DOMParser).parseFromString(n,"text/html").body);var n;t(i,this)}loadTemplate(e="",t=!1){this.template=""===e?this.template:`${e}`,this.render(t)}disconnectedCallback(){this.onDestroy?.()}}customElements.get("nb-nespresso-element")||customElements.define("nb-nespresso-element",t);const i={get is(){const{innerWidth:t,devicePixelRatio:i}=window;return{mobile:t<768,mobile_tablet:t<e,tablet:t>=768&&t<e,desktop:t>=e&&i<=1,retina:t>=e&&i>1}},lt:e=>window.innerWidth<e},n=e=>r(JSON.stringify(e)),r=e=>{const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,(e=>t[e]))},s="plp",a=e=>"pdp"===e,o=e=>{const{url:t,name:i="",name_custom:n=""}=e;if(!i)return"";const r=""!==n?n:i,s=[],o=(({variation:e})=>a(e)?"h1":"h3")(e);return s.push(`<${o} class="cb-heading">`),t&&!a(e.variation)?s.push((({url:e,a11y_product_card:t="",name:i="",name_custom:n=""})=>{const r=t.replace("{productName}",i);return`<a href="${e}" target="_self" title="${r}" aria-label="${r}">${""!==n?n:i}</a>`})(e)):s.push(`${r}`),s.push(`</${o}>`),s.join("")},c="capsule",l="/machineTechno/",d=e=>window.napi.catalog().getProduct((e=>e.replace(/[^a-z0-9- +./]/gi,""))(e));function p(e){const t=e.technologies[0];return t.substring(t.indexOf(l)+15)}const u=async e=>{const t=await(async()=>await window.napi.priceFormat())(),i=window[window.config.padl.namespace].dataLayer.app.app.currency;return t.html?t.html(i,e):t.short(i,e)||""},h=e=>e.querySelector(".cb-price-old"),_=({strikethrough_price:e},t)=>{return e?((i=e,u(i)).then((e=>{const i=h(t);i&&(i.innerHTML=e)})).catch((e=>{console.error(`Error: Component SKU - Strike Through Price  - ${e}`);const i=h(t);i&&(i.style.display="none")})),'<p class="cb-price-old"></p>'):"";var i},m=async(e,t,i,n)=>{if("string"!=typeof t)return;const r=await(async(e,t)=>{let i=t;return i||(i=await d(e)),i})(i,n),s=((e,t={})=>{const{internationalName:i,internationalId:n,category:r,unitPrice:s,legacyId:a,name:o,technologies:c,bundled:l,inStock:d,type:p}=e,u=c.map((e=>e.split("/").pop())).join("|");return[{...t,name:i,id:n,price:s,dimension44:r.toLowerCase().includes("discovery").toString(),dimension53:a,dimension54:o,dimension55:r,dimension56:u,dimension57:l?"bundle":"single",dimension192:d?"in stock":"out of stock",category:p,brand:"Nespresso"}]})(r,{position:e}),a=r.currency;window.gtmDataObject=window.gtmDataObject||[],window.gtmDataObject.push({event:"productClick",eventAction:"Product Click",currencyCode:a,eventRaisedBy:"Page Builder",ecommerce:{click:{actionField:{list:t},products:s}}})};class g extends t{constructor(){super(),this.type="default",this.popinId="",this.isQuickViewPlp=!1,this.boundOnPDPLinkClick=this.onPDPLinkClick.bind(this),this.boundOnQuickViewOpen=this.onQuickViewOpen.bind(this),this.clickMethod=this.boundOnPDPLinkClick}loadTemplate(){this.classList.add("nb-sku"),this.classList.add(`nb-sku__${this.type}`),(({variation:e,type:t},n)=>{"pdp"===e&&n.setAttribute("pdp","true"),e===s&&t===c&&i.is.mobile?n.setAttribute("landscape","true"):n.setAttribute("portrait","true")})(this.props,this),Object.assign(this.props,this.getSleevePrice(this.props));const{quick_view_plp:e={}}=this.props;this.isQuickViewPlp=e?.show_view||!1,this.clickMethod=this.isQuickViewPlp?this.boundOnQuickViewOpen:this.boundOnPDPLinkClick,this.template=`${this.renderVisual()}\n                          ${this.renderHeader()}\n                          <div class="cb-content">\n                              ${this.renderInformation()}\n                              ${this.isQuickViewPlp?this.renderQuickView():""}\n                              <div class="cb-shop">\n                                  <div class="cb-price">\n                                      ${this.renderPricing()}\n                                  </div>\n                                  ${this.renderAction()}\n                              </div>\n                              ${this.renderFooter()}\n                          </div>`,this.render()}onReady(){const{activeSku:e,sku:t}=this.props;this.setAttribute("data-product-short-sku",e||t),this.bindEvent()}renderHeaderDefault(){return`${(({labels:e=[]},t=null)=>{if(!t||!e||!e.length)return"";t&&e.length&&t.classList.add("has-labels");const r=i.is.mobile?"row":"column";return`<nb-card-labels data="${n({labels:e})}" direction="${r}"></nb-card-labels>`})(this.props,this)}${((e,t)=>{const{fair_trade:i,alt_fair_trade:r,is_organic:s,alt_organic:a,only_vertuo_next:o,alt_vertuo_next:c,is_rainforest:l,alt_rainforest:d,is_sustainable:p,alt_sustainable:u,is_q_certified_arabica:h,alt_q_certification_arabica:_,logos:m}=e;return i||s||o||l||p||h||!(null==m||m.length<1)?(t.classList.add("has-logos"),`<nb-card-logos data='${n({fair_trade:i,alt_fair_trade:r,is_organic:s,alt_organic:a,only_vertuo_next:o,alt_vertuo_next:c,is_rainforest:l,alt_rainforest:d,is_sustainable:p,alt_sustainable:u,is_q_certified_arabica:h,alt_q_certification_arabica:_,logos:m})}'></nb-card-logos>`):""})(this.props,this)}`}renderHeader(){return this.renderHeaderDefault()}renderVisualDefault(){const e=this.hasAttribute("portrait")?"portrait":"landscape";return(({url:e,image_alt_text:t,image:i,quick_view_plp:n={}},r="portrait")=>{if(!i)return"";let s=`<nb-img file="${i}"\n        description="${t}"\n        aspect_ratio="${"portrait"===r?"16/9":"1/1"}"\n        object_fit="contain"\n        force_height="${"portrait"===r?"160":"120"}">\n    </nb-img>`;return(e||n?.show_view)&&(s=`<a href="${e||"javascript:void(0)"}" target="_self" aria-hidden="true" tabindex="-1">${s}</a>`),`<div class="cb-image">\n                ${s}\n            </div>`})(this.props,e)}getSleevePrice({number_of_sleeves:e,price:t}){let i,n=!0;return"1"===e?i=t:n=!1,{hasPricePerSleeve:n,sleevePrice:i}}renderVisual(){return this.renderVisualDefault()}renderInformationDefault(){return`${(({label_technology:e})=>e?`<p class="cb-technology t-xs-700">${e}</p>`:"")(this.props)}\n        ${(({label_range:e})=>e?`<p class="cb-range t-xs-500">${e}</p>`:"")(this.props)}\n        ${o(this.props)}\n        ${(({headline:e="",is_headline_hidden:t=!1})=>t&&i.is.mobile||!e?"":`<p class="cb-text">${e}</p>`)(this.props)}`}renderInformation(){return this.renderInformationDefault()}renderQuickView(){return(({sku:e,quick_view:t,tracking_list:i,tracking_position:n})=>t&&t.label&&t.popin_id?`<nb-link\n        color="gold"\n        size="large"\n        popin_id="${t.popin_id}"\n        sku='${e}'\n        tracking_list='${i}'\n        tracking_position='${n}'>${t.label}</nb-link>`:"")(this.props)}renderPricingDefault(){return`${_(this.props,this)}\n                ${(({price:e,hidePrice:t,giftcard_price:i,price_per_capsule:n,show_sleeve_price:r,type:s})=>{if(!e&&!i||t)return"";let a=null;return a=!r&&n?n:e,s!==c&&(a=e),`<p class="cb-price-current"><span>${a||i}</span></p>`})(this.props)}`}renderPricing(){return this.renderPricingDefault()}renderActionDefault(){return(e=>{const{category_name:t="",activeSku:n,sku:r,activeLongSku:a,longSku:o="",position:c,variation:l=s,hidePrice:d,url:p,view_details_label:u="View details",show_view_details:h=!1,rendererName:_="",is_machine_b2b:m=!1,contact_cta:g={}}=e;let b="large";l===s&&(b=i.is.mobile?"small":"large"),"small"===l&&(b="small");let k=p,v=u,y=g.show_contact_cta||!1,f=g.contact_cta_text||"",w=g.contact_url_anchor||"";return d||h?m&&y?(k=w,v=f,`<nb-cta\n            ${w?`link="${k}"`:""}\n            variation="primary">${v}</nb-cta>`):`<nb-cta link="${k}" variation="primary">${v}</nb-cta>`:`\n        <nb-add-to-cart\n            sku="${n||r}"\n            longSku="${a||o}"\n            buttonSize="${b}"\n            showPrice\n            range='${t}'\n            position='${c}'\n            rendererName='${_}'\n        ></nb-add-to-cart>\n    `})(this.props)}renderAction(){const e=this.querySelector('[slot="action"]')?.outerHTML;return e||this.renderActionDefault()}renderFooterDefault(){return(({additional_message_icon:e,additional_message:t,additional_message_link:i})=>{if(!t&&!i)return"";let n="";if(t){let i="";e&&(i=`<nb-icon icon="${e}" class="additionalMsgIcon"></nb-icon>`),n=`<p class="cb-warn t-sm-500-sl">\n            ${i}\n            ${t}</p>`}return i&&i.link&&i.label?n+`<nb-link\n            link='${i.link}'\n            color="${i.color}"\n            size="${i.size}"\n            seo_label="${i.seo_label}">\n            ${i.label}\n        </nb-link>`:n})(this.props)}renderFooter(){return this.renderFooterDefault()}async onPDPLinkClick(){const e=this.getAttribute("tracking_position")||0,t=this.getAttribute("tracking_list")||"";await m(e,t,this.props.longSku)}async renderSkuQuickView(){this.popinId="plp-quick-view";let e=document.querySelector(`#${this.popinId}`);e&&e.remove();const{sku:t}=this.props;t&&await(async(e,t,i)=>{try{const n=await d(e),{tracking_position:r,tracking_list:s}=i;if(!n)return;let a=document.createElement("nb-sku-quick-view");a.setAttribute("data",JSON.stringify(((e,t,i)=>{const{sku:n,longSku:r,categoryName:s,price:a,url:o,quick_view_plp:c,strikethrough_price:l,hidePrice:d,campaign:p}=t;var u;return{popin:{popin_id:e,close:c.popin.close,footer:!0},product:{...t,...i,...(u=i.capsuleProperties,{acidity:{value:u?.acidity},bitterness:{value:u?.bitterness},body:{value:u?.body},capsuleProperties:{intensity:u?.intensity},roast:{value:u?.roastLevel}})},intensity:{intensity_label:"Intensity",a11y_intensity_max:"max of {max_intensity}"},cup_sizes:{...c.cup_sizes,items:t.cupSizesDetails},aromatic_profile:{...c.aromatic_profile,items:i.capsuleProductAromatics},link:{...c.link,url:o},levels:{...c.levels},pricing:{add_to_cart:{sku:n,longSku:r,category_name:s,position:"",variation:"small",price:a,strikethrough_price:l,hidePrice:d,url:"",view_details_label:"View details",rendererName:""},showSleeve:{},showCapsulePrice:{}},campaign:p}})(t,i,n))),a.setAttribute("id",t),a.setAttribute("tracking_no_impression",!0),a.setAttribute("tracking_position",r),a.setAttribute("tracking_list",s),document.body.appendChild(a)}catch(t){console.error(`getProduct fail on sku ${e}`)}})(t,this.popinId,this.props)}async onQuickViewOpen(e){return e.preventDefault(),await this.renderSkuQuickView(),(({creative:e="",actionType:t="",internationalId:i="",internationalName:n="",productType:r="",technology:s="",category:a="",rawPrice:o="",eventAction:c=""})=>{window.gtmDataObject=window.gtmDataObject||[],window.gtmDataObject.push({event:"page_builder_component_interaction",event_raised_by:"page builder",component_name:e,action_type:t,item_id_event:i,item_name_event:n,item_category_event:r,item_technology_event:s,item_range_event:a,item_price_event:o,eventCategory:"User Engagement",eventAction:c,eventLabel:`${r} - ${s} - ${n}`})})({creative:this.props.campaign?.creative,actionType:"pdp quick view",internationalId:this.props.internationalId,internationalName:this.props.internationalName,productType:this.props.type,technology:p(this.props),category:this.props.category,rawPrice:this.props.rawPrice,eventAction:"PDP Quick View"}),(({eventName:e,args:t,element:i})=>{let n;i=i||window,t?n=new CustomEvent(e,{detail:t,bubbles:!0}):"function"==typeof Event?n=new Event(e):(n=document.createEvent("Event"),n.initEvent(e,!0,!0)),i.dispatchEvent(n)})({eventName:"WEB_COMPONENT_POPIN_OPEN",args:{id:this.popinId}}),!1}bindEvent(){this.unbindEvent(),this.linkElements=this.querySelectorAll("a[href]"),this.linkElements.length&&Array.from(this.linkElements).forEach((e=>{e.addEventListener("click",this.clickMethod)}))}unbindEvent(){this.linkElements&&this.linkElements.length&&(Array.from(this.linkElements).forEach((e=>{e.removeEventListener("click",this.clickMethod)})),this.linkElements=[])}disconnectedCallback(){this.unbindEvent()}}customElements.get("nb-sku")||customElements.define("nb-sku",g);class b extends g{constructor(){super(),this.type="accessory"}}customElements.get("nb-sku-accessory")||customElements.define("nb-sku-accessory",b);export{b as default};
