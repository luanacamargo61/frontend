// add-to-cart 1.1.1 2/8/2022 2:06:24 PM
class t{constructor(){this.events={}}on(t,e){(t=[].concat(t)).forEach((t=>{this.events[t]=(this.events[t]||[]).concat(e)}))}off(t){delete this.events[t]}fire(t,...e){if(!this.events[t])return!1;this.events[t].forEach((t=>t(...e)))}all(){return this.events}}class e{constructor(e={xs:575,sm:767,md:995,lg:1366,xl:1920,xxl:2560}){const i=Object.keys(e);if(0===i.length)throw new Error("You should configure breakpoints");this._events=new t,Object.assign(this,e),this._sorted=i.map((t=>({name:t,value:this[t],["is"+t.toUpperCase()]:!0}))).sort(((t,e)=>t.value-e.value));let n=this.current,s=this.landscape;window.addEventListener("resize",function(t,e,i={}){let n;return i.hasOwnProperty("trailing")||(i.trailing=!0),function(){const s=this,r=arguments,o=()=>{n=null,i.trailing&&t.apply(s,r)},a=i.leading&&!n;clearTimeout(n),n=setTimeout(o,e),a&&t.apply(s,r)}}((()=>{const t=this.landscape,e=this.current,i=s!==t;(e.value!==n.value||i)&&(this._events.fire("change",{last:n,current:e,landscape:t,portrait:!t}),n=e),i&&(s=t,this._events.fire("orientation",{landscape:t,portrait:!t}))}),200))}on(t,e,i=!1){if(this._events.on(t,e),i){const t=this.current;e({last:t,current:t,landscape:this.landscape,portrait:!this.landscape})}}off(t){this._events.off(t)}get current(){const t=this.viewportSize.width,e=this._sorted;let i;for(let n=0;n<e.length;n++){const s=e[n];if(t<=s.value&&(0===n||t>i.value))return s;i=s}}get viewportSize(){const t=document.documentElement;return{width:t.clientWidth,height:t.clientHeight}}get landscape(){return this.viewportSize.width>this.viewportSize.height}get portrait(){return!this.landscape}isBetween(t,e){return this.viewportSize.width>=this[t]&&this.viewportSize.width<=this[e]}isLessThan(t){return this.viewportSize.width<this[t]}isGreaterThan(t){return this.viewportSize.width>this[t]}isLessThanEqualTo(t){return this.viewportSize.width<=this[t]}isGreaterThanEqualTo(t){return this.viewportSize.width>=this[t]}}const i=window.navigator.userAgent;const n=new class{constructor(t,i=!1){this.items=new Map,this.isLandscape=null,this.breakpoints=new e,this.breakpoints.on("orientation",(t=>this.setOrientation(t.landscape))),this.isActivateIeAndEdge=i,this.setOptions(t)}setOptions(t={}){this.hasIntersectionObserver()&&(this.settings={isLandscape:{above:[0],rootMargin:"200% 0px"},isPortrait:{above:[0],rootMargin:"200% 0px"},...t},this.setOrientation(this.breakpoints.landscape))}isIeOrEdge(){return function(){const t=i.indexOf("Edge/");return t>0&&parseInt(i.substring(t+5,i.indexOf(".",t)),10)}()||function(){const t=i.indexOf("MSIE ");if(t>0)return parseInt(i.substring(t+5,i.indexOf(".",t)),10);if(i.indexOf("Trident/")>0){const t=i.indexOf("rv:");return parseInt(i.substring(t+3,i.indexOf(".",t)),10)}return!1}()}hasIntersectionObserver(){return(!this.isIeOrEdge()||this.isIeOrEdge()&&this.isActivateIeAndEdge)&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window}setOrientation(t){if(!this.hasIntersectionObserver())return;if(this.isLandscape===t)return;this.observer&&(this.unobserveItems(),this.observer.disconnect()),this.isLandscape=t;const{above:e,rootMargin:i}=this.settings[t?"isLandscape":"isPortrait"];this.observer=new IntersectionObserver((t=>this.onChange(t)),{threshold:e,rootMargin:i})}addItem(t){this.hasIntersectionObserver()?this.observeItem(t):this.resolve(t)}observeItem(t){const{element:e}=t;if(!this.observer)throw new Error("You must call `setOrientation` before starting to observe item");this.items.has(e)||this.observer.observe(e),delete t.element,this.items.set(e,t)}resolve({element:t,onViewportEnter:e}){this.items.set(t,{onViewportEnter:e}),this.callCallback({target:t})}onChange(t){t.forEach((t=>{!0===t.isIntersecting||void 0===t.isIntersecting&&t.intersectionRatio>0?(this.callCallback(t),this.getCallbackNotInViewPort(t)||this.unobserve(t)):this.callCallbackNotInViewPort(t)}))}callCallback(t){const e=this.getCallback(t);e&&e()}callCallbackNotInViewPort(t){const e=this.getCallbackNotInViewPort(t);e&&e()}getCallback(t){const{onViewportEnter:e}=this.items.get(t.target)||{};return"function"==typeof e&&e}getCallbackNotInViewPort(t){const{onViewportOut:e}=this.items.get(t.target)||{};return"function"==typeof e&&e}unobserve(t){this.observer&&this.observer.unobserve(t.target),this.items.delete(t.target)}unobserveItems(){this.items.forEach(((t,e)=>this.observer.unobserve(e)))}observeItems(){this.items.forEach(((t,e)=>this.observer.observe(e)))}}({isLandscape:{above:[0],rootMargin:"0% 0%"},isPortrait:{above:[0],rootMargin:"0% 0%"}});function s(t){const e=document.implementation.createHTMLDocument("");return e.body.innerHTML=t,e.body.childNodes}class r extends class{getIom(){return n}constructor(t){var e,i,s;(this.el=t,this.el instanceof Element||this.el instanceof HTMLDocument)&&(n.hasIntersectionObserver()?n.addItem({element:this.el,onViewportEnter:()=>this.track()}):(this.scrollHandler=function(t,e,i={}){let n,s,r;i.hasOwnProperty("leading")||(i.leading=!0);let o=null,a=0;const c=()=>{a=i.leading?Date.now():0,o=null,r=t.apply(n,s),o||(n=s=null)};return function(){const l=Date.now();a||i.leading||(a=l);const h=e-(l-a);return n=this,s=arguments,h<=0||h>e?(o&&(clearTimeout(o),o=null),a=l,r=t.apply(n,s),o||(n=s=null)):!o&&i.trailing&&(o=setTimeout(c,h)),r}}(this.isInViewport.bind(this),500),e=window,i="scroll",s=this.scrollHandler,e.addEventListener(i,s)))}isInViewport(){const t=this.el,e=window.pageYOffset,i=function(t){const e=function(t){return t.getBoundingClientRect()}(t);return{top:e.top+document.body.scrollTop,left:e.left+document.body.scrollLeft}}(t).top,n=function(t,e){let i=t.offsetHeight;if(e){const e=getComputedStyle(t);i+=parseInt(e.marginTop||0)+parseInt(e.marginBottom||0)}return i}(t),s=e+window.innerHeight;s>=i+n/2&&(e<=i||s<=i+1.5*n)&&(this.track(),this.destroy())}track(){"requestIdleCallback"in window?window.requestIdleCallback((()=>this.runTrack())):window.setTimeout((()=>this.runTrack()),1)}runTrack(){}destroy(){var t,e,i;t=window,e="scroll",i=this.scrollHandler,t.removeEventListener(e,i)}}{constructor(t,e,i){super(t),this.data=e,this.currency=i}runTrack(){this.data&&this.getCategories(this.data).then((t=>{window.impressionsOnScroll=window.impressionsOnScroll||{},window.impressionsOnScroll[this.data.internationalId]=this.buildGTMProductObject(this.data,t)}))}getCategories(t){return Promise.all(t.supercategories.map((t=>window.napi.catalog().getCategory(t)))).then((t=>{const e=[];for(const i of t){const t=i.code;if(!t)return;(~t.indexOf("-cupSize-")||~t.indexOf("-range-")||~t.indexOf("capsule-aromatic-")||~t.indexOf("machine-keyFeature-")||~t.indexOf("machine-color-")||~t.indexOf("accessory-collection-")||~t.indexOf("accessory-hero-month"))&&e.push(i.name.toLowerCase())}return e.join("|")}))}buildGTMProductObject(t,e){let i;return"capsule"===t.type?i="capsules":"accessory"===t.type?i="accessories":"machine"===t.type&&(i="machines"),{brand:"Nespresso",category:i,dimension43:"false",dimension44:"false",dimension53:t.legacyId,dimension54:s(t.name)[0].textContent,dimension55:e,dimension56:t.technologies?t.technologies.map((t=>function(t=""){return t[0].toUpperCase()+t.slice(1)}(t.split("/")[2]))).join("|||"):null,dimension57:t.bundled?"bundled":"single",dimension130:t.productSelections.join("|"),id:t.internationalId,name:s(t.internationalName)[0].textContent,price:t.price}}}class o extends HTMLElement{render(){this.innerHTML=`<span class="ProductListElement__price"></span>\n                            <div class="c-AddToCart" id="u-product-${this.elementID}">\n                                <div class="c-AddToCartDefault" role="button" tabindex="0">\n                                    <span>+</span>\n                                </div>\n                            </div>`}_isWindowNapiActive(){return!!window.napi}_pushButton(){if(!document.getElementById(`u-product-${this.elementID}`))return;const t=this.buttonSize;window.ui=window.ui||[],window.ui.push({id:`u-product-${this.elementID}`,module:"AddToBagButton",configuration:{props:{productId:this.sku,buttonSize:t}},ecommerceData:{activated:!0}})}connectedCallback(){this.sku=(this.getAttribute("sku")||"").trim(),this.buttonSize=this.getAttribute("buttonSize")||"small",this.elementID=this.sku+(new Date).getTime()+Math.random(),this.render(),this._isWindowNapiActive()&&(window.napi.getConfig().then((()=>{this._pushButton()})).catch((t=>console.error(t))),this.showPrice().then((()=>{this.price&&(this.querySelector(".ProductListElement__price").innerHTML=this.price)})).catch((t=>console.error(t))))}async showPrice(){if(!this._isWindowNapiActive())return new Promise.resolve;try{const t=await window.napi.catalog().getProduct(this.sku),e=await window.napi.priceFormat(),i=window[window.config.padl.namespace].dataLayer.app.app.currency;!function(t,e,i){const n=new r(t,e,i)}(this,t,i),this.price=e.html(i,t.price)}catch(t){throw new Error(`getProduct fail on sku ${this.sku}`)}}disconnectedCallback(){}}customElements.get("n-add-to-cart")||customElements.define("n-add-to-cart",o);export{o as default};
